<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hollow Kitty 拉霸機</title>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // -----------------------------------------------------------------------------
        // 圖標組件 (替代 lucide-react)
        // -----------------------------------------------------------------------------
        const RefreshCw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                <path d="M8 16H3v5"/>
            </svg>
        );

        const Trophy = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                <path d="M4 22h16"/>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
            </svg>
        );

        const RotateCw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
            </svg>
        );

        const AlertCircle = ({ size, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size || 24} height={size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" x2="12" y1="8" y2="12"/>
                <line x1="12" x2="12.01" y1="16" y2="16"/>
            </svg>
        );

        // -----------------------------------------------------------------------------
        // 設定資料
        // -----------------------------------------------------------------------------

        const PARTS = ['head', 'accessory', 'body', 'feet'];
        const PARTS_LABEL = {
            head: '頭部 (Head)',
            accessory: '髮飾 (Bow)',
            body: '身體 (Body)',
            feet: '腳部 (Feet)'
        };

        const STYLES = ['normal', 'green', 'caramel', 'silver'];

        const STYLE_CONFIG = {
            normal: { 
                name: '經典原版',
                color: '#EF4444', 
                accent: '#EFF6FF',
                bg: 'bg-red-50',
                border: 'border-red-400',
                text: 'text-red-600'
            },
            green: { 
                name: '綠色款', 
                color: '#4ADE80', 
                accent: '#DCFCE7', 
                bg: 'bg-green-100',
                border: 'border-green-400',
                text: 'text-green-600'
            },
            caramel: { 
                name: '焦糖款', 
                color: '#FB923C', 
                accent: '#FFEDD5', 
                bg: 'bg-orange-100',
                border: 'border-orange-400',
                text: 'text-orange-600'
            },
            silver: { 
                name: '銀色款', 
                color: '#94A3B8', 
                accent: '#E2E8F0', 
                bg: 'bg-slate-100',
                border: 'border-slate-400',
                text: 'text-slate-600'
            }
        };

        // -----------------------------------------------------------------------------
        // SVG 組件
        // -----------------------------------------------------------------------------

        const KittyPart = ({ part, styleType, isAnimating }) => {
            if (!styleType) return null;
            const config = STYLE_CONFIG[styleType];
            const isClassic = styleType === 'normal';

            let stroke, fill;

            if (isClassic) {
                stroke = '#111827'; 
                fill = '#FFFFFF';   
            } else {
                stroke = config.color;
                fill = config.accent;
            }

            const animClass = isAnimating ? 'animate-pulse opacity-50' : 'transition-all duration-500 ease-out';

            switch (part) {
                case 'feet':
                    const feetFill = isClassic ? '#1D4ED8' : stroke; 
                    return (
                        <g className={animClass} transform="translate(0, 10)">
                            <ellipse cx="85" cy="180" rx="16" ry="12" fill={feetFill} stroke={stroke} strokeWidth="3"/>
                            <ellipse cx="115" cy="180" rx="16" ry="12" fill={feetFill} stroke={stroke} strokeWidth="3"/>
                        </g>
                    );
                case 'body':
                    const bodyFill = isClassic ? '#1D4ED8' : fill; 
                    const armFill = isClassic ? '#FFFFFF' : fill;
                    const buttonColor = isClassic ? '#FCD34D' : stroke;

                    return (
                        <g className={animClass}>
                            <path d="M75 130 L55 145 C50 150, 50 160, 60 160 L75 150" fill={armFill} stroke={stroke} strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                            <path d="M125 130 L145 145 C150 150, 150 160, 140 160 L125 150" fill={armFill} stroke={stroke} strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                            <path d="M80 125 L120 125 L132 175 L68 175 Z" fill={bodyFill} stroke={stroke} strokeWidth="3" />
                            <path d="M80 125 Q100 145 120 125" fill={isClassic ? '#FFFFFF' : fill} stroke={stroke} strokeWidth="3" />
                            <circle cx="88" cy="140" r="4" fill={buttonColor} stroke={stroke} strokeWidth="1" />
                            <circle cx="112" cy="140" r="4" fill={buttonColor} stroke={stroke} strokeWidth="1" />
                        </g>
                    );
                case 'head':
                    const faceFill = isClassic ? '#FFFFFF' : config.accent;
                    const noseColor = '#FCD34D'; 
                    const eyeColor = '#111827';  
                    
                    return (
                        <g className={animClass}>
                            <path d="M65 75 L55 35 Q75 30 85 55 Z" fill={faceFill} stroke={stroke} strokeWidth="3" strokeLinejoin="round"/>
                            <path d="M135 75 L145 35 Q125 30 115 55 Z" fill={faceFill} stroke={stroke} strokeWidth="3" strokeLinejoin="round"/>
                            <ellipse cx="100" cy="90" rx="55" ry="40" fill={faceFill} stroke={stroke} strokeWidth="3" />
                            <ellipse cx="78" cy="95" rx="4" ry="6" fill={eyeColor} />
                            <ellipse cx="122" cy="95" rx="4" ry="6" fill={eyeColor} />
                            <ellipse cx="100" cy="108" rx="5" ry="3" fill={noseColor} stroke={stroke} strokeWidth="1" />
                            <g stroke={stroke} strokeWidth="2" strokeLinecap="round">
                                <path d="M55 85 L30 80" />
                                <path d="M55 95 L25 95" />
                                <path d="M55 105 L30 110" />
                                <path d="M145 85 L170 80" />
                                <path d="M145 95 L175 95" />
                                <path d="M145 105 L170 110" />
                            </g>
                        </g>
                    );
                case 'accessory':
                    const bowFill = isClassic ? '#EF4444' : config.color; 
                    const bowStroke = stroke;

                    return (
                        <g className={animClass} transform="translate(5, 5)">
                            <g transform="rotate(-15, 140, 50)">
                                <path d="M130 50 Q110 30 130 30 L140 50 L130 70 Q110 70 130 50" fill={bowFill} stroke={bowStroke} strokeWidth="2.5" />
                                <path d="M150 50 Q170 30 150 30 L140 50 L150 70 Q170 70 150 50" fill={bowFill} stroke={bowStroke} strokeWidth="2.5" />
                                <circle cx="140" cy="50" r="8" fill={bowFill} stroke={bowStroke} strokeWidth="2.5"/>
                                <path d="M135 50 Q130 40 125 45" fill="none" stroke={isClassic ? '#991B1B' : '#FFF'} strokeWidth="1" opacity="0.5" />
                                <path d="M145 50 Q150 40 155 45" fill="none" stroke={isClassic ? '#991B1B' : '#FFF'} strokeWidth="1" opacity="0.5" />
                            </g>
                        </g>
                    );
                default:
                    return null;
            }
        };

        // -----------------------------------------------------------------------------
        // 主程式
        // -----------------------------------------------------------------------------

        const HollowKittySlot = () => {
            const [storedParts, setStoredParts] = useState({
                head: null,
                accessory: null,
                body: null,
                feet: null
            });

            const [spinningParts, setSpinningParts] = useState({});
            const [result, setResult] = useState({ complete: false, score: 0, isPerfect: false });

            const spinPart = (partKey) => {
                if (storedParts[partKey] || spinningParts[partKey]) return;

                setSpinningParts(prev => ({ ...prev, [partKey]: true }));

                const spinDuration = 500 + Math.random() * 500;

                setTimeout(() => {
                    const randomStyle = STYLES[Math.floor(Math.random() * STYLES.length)];
                    setStoredParts(prev => ({ ...prev, [partKey]: randomStyle }));
                    setSpinningParts(prev => ({ ...prev, [partKey]: false }));
                }, spinDuration);
            };

            useEffect(() => {
                const allFilled = PARTS.every(part => storedParts[part] !== null);
                if (allFilled && !result.complete) {
                    setTimeout(() => {
                        calculateScore();
                    }, 500);
                }
            }, [storedParts]);

            const calculateScore = () => {
                const values = Object.values(storedParts);
                
                // 計算每個樣式出現的次數
                const counts = {};
                values.forEach(val => {
                    counts[val] = (counts[val] || 0) + 1;
                });
                
                // 找出重複次數最多的數量 (maxCount)
                // 例如：3個綠色、1個紅色 -> maxCount = 3
                // 例如：2個綠色、2個紅色 -> maxCount = 2
                // 例如：全部不同 -> maxCount = 1
                const maxCount = Math.max(...Object.values(counts));

                let score = 0;
                let isPerfect = false;

                if (maxCount === 4) {
                    score = 100;
                    isPerfect = true;
                } else if (maxCount === 3) {
                    score = 60;
                } else if (maxCount === 2) {
                    score = 30;
                } else {
                    score = 10; // 全部不同色，給予參與分
                }

                setResult({
                    complete: true,
                    score: score,
                    isPerfect: isPerfect
                });
            };

            const resetGame = () => {
                setStoredParts({ head: null, accessory: null, body: null, feet: null });
                setResult({ complete: false, score: 0, isPerfect: false });
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans p-4 flex flex-col items-center">
                    <header className="mb-6 text-center">
                        <h1 className="text-3xl font-bold text-slate-800 mb-1 tracking-wider">Hollow Kitty</h1>
                        <p className="text-sm text-slate-500">蒐集組裝你的專屬角色</p>
                    </header>

                    <div className="w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div className="flex flex-col items-center justify-center bg-white rounded-3xl shadow-xl p-6 relative overflow-hidden min-h-[400px]">
                            <div className="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-pink-200 to-transparent pointer-events-none"></div>

                            <div className={`relative w-64 h-64 transition-transform duration-1000 ${result.isPerfect ? 'rotate-[360deg] scale-110' : ''}`}>
                                <svg viewBox="0 0 200 220" className="w-full h-full drop-shadow-lg">
                                    <KittyPart part="feet" styleType={storedParts.feet} isAnimating={spinningParts.feet} />
                                    <KittyPart part="body" styleType={storedParts.body} isAnimating={spinningParts.body} />
                                    <KittyPart part="head" styleType={storedParts.head} isAnimating={spinningParts.head} />
                                    <KittyPart part="accessory" styleType={storedParts.accessory} isAnimating={spinningParts.accessory} />
                                    
                                    {Object.values(storedParts).every(v => v === null) && !Object.values(spinningParts).some(v => v) && (
                                        <text x="100" y="130" textAnchor="middle" fontSize="60" fill="#E2E8F0" fontFamily="sans-serif">?</text>
                                    )}
                                </svg>
                            </div>

                            <div className="mt-8 text-center h-16 flex flex-col items-center justify-center">
                                {result.complete ? (
                                    <div className={`animate-bounce ${result.isPerfect ? 'text-yellow-500' : 'text-slate-700'}`}>
                                        {result.score === 100 && (
                                            <>
                                                <div className="text-2xl font-black flex items-center gap-2 justify-center text-yellow-500">
                                                    <Trophy className="w-6 h-6" /> Perfect Set! +100
                                                </div>
                                                <div className="text-sm text-yellow-600">完美套裝達成！</div>
                                            </>
                                        )}
                                        {result.score === 60 && (
                                            <>
                                                <div className="text-2xl font-black flex items-center gap-2 justify-center text-indigo-500">
                                                    Great! +60
                                                </div>
                                                <div className="text-sm text-indigo-600">運氣不錯！三個部位同色系</div>
                                            </>
                                        )}
                                        {result.score === 30 && (
                                            <>
                                                <div className="text-2xl font-black flex items-center gap-2 justify-center text-blue-500">
                                                    Good! +30
                                                </div>
                                                <div className="text-sm text-blue-600">還可以！兩個部位同色系</div>
                                            </>
                                        )}
                                        {result.score === 10 && (
                                            <>
                                                <div className="text-2xl font-black flex items-center gap-2 justify-center text-slate-500">
                                                    Mix Style +10
                                                </div>
                                                <div className="text-sm text-slate-400">混搭風格，感謝參與！</div>
                                            </>
                                        )}
                                    </div>
                                ) : (
                                    <div className="text-slate-400 text-sm">
                                        {Object.values(spinningParts).some(Boolean) 
                                            ? "組裝中..." 
                                            : "點擊下方按鈕抽取部位 (每部位限一次)"}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="flex flex-col gap-4 justify-center">
                            <div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-2 rounded-r-lg">
                                <h3 className="font-bold text-blue-800 text-sm flex items-center gap-2">
                                    <AlertCircle size={16}/> 遊戲規則
                                </h3>
                                <ul className="text-xs text-blue-700 mt-1 list-disc list-inside space-y-1">
                                    <li>每個部位只能抽一次，無法重來。</li>
                                    <li>4個同色系：<strong>100分</strong> (完美)</li>
                                    <li>3個同色系：<strong>60分</strong></li>
                                    <li>2個同色系：<strong>30分</strong></li>
                                    <li>全部不同色：<strong>10分</strong> (參與獎)</li>
                                </ul>
                            </div>

                            <div className="grid grid-cols-1 gap-3">
                                {PARTS.map((part) => {
                                    const currentStyleKey = storedParts[part];
                                    const isLocked = currentStyleKey !== null;
                                    const isSpinning = spinningParts[part];
                                    
                                    const styleConfig = currentStyleKey ? STYLE_CONFIG[currentStyleKey] : null;

                                    return (
                                        <div key={part} className="flex items-center gap-3">
                                            <button
                                                onClick={() => spinPart(part)}
                                                disabled={isLocked || isSpinning || result.complete}
                                                className={`
                                                    flex-1 h-16 rounded-xl flex items-center justify-between px-6 border-b-4 transition-all
                                                    ${isLocked 
                                                        ? 'bg-white border-slate-200 text-slate-400 cursor-default' 
                                                        : 'bg-indigo-500 border-indigo-700 text-white hover:bg-indigo-600 active:border-b-0 active:translate-y-1'
                                                    }
                                                    ${isSpinning ? 'animate-pulse' : ''}
                                                `}
                                            >
                                                <span className="font-bold tracking-wide flex items-center gap-2">
                                                    {isSpinning && <RefreshCw className="animate-spin w-4 h-4"/>}
                                                    {PARTS_LABEL[part]}
                                                </span>
                                                
                                                <span className="text-sm font-medium">
                                                    {isSpinning ? '轉動中...' : (styleConfig ? styleConfig.name : '點擊抽取')}
                                                </span>
                                            </button>
                                            
                                            <div className={`
                                                w-4 h-16 rounded-full transition-colors duration-500
                                                ${styleConfig ? styleConfig.bg : 'bg-slate-200'}
                                            `}></div>
                                        </div>
                                    );
                                })}
                            </div>

                            {result.complete && (
                                <button 
                                    onClick={resetGame}
                                    className="mt-4 w-full py-4 bg-slate-800 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-700 transition-colors shadow-lg"
                                >
                                    <RotateCw className="w-5 h-5" />
                                    再來一局
                                </button>
                            )}
                        </div>
                    </div>
                    
                    <footer className="mt-8 text-xs text-slate-400">
                        Design for College Students • High Risk High Return
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HollowKittySlot />);
    </script>
</body>
</html>